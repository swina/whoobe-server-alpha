(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0a4f5f"],{"0955":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.user?i("div",{staticClass:"p-4"},[i("h3",[t._v("Staging: Transfer to Production")]),t.enabled?i("div",[i("div",{staticClass:"flex flex-row"},[i("button",{staticClass:"rounded-none bg-white text-blue-300 mr-2",on:{click:function(e){t.start=0,t.limit=10,t.mode="articles"}}},[t._v("Articles")]),i("button",{staticClass:"rounded-none bg-white text-blue-300 mr-2",on:{click:function(e){t.start=0,t.limit=10,t.mode="components"}}},[t._v("Components")])]),i("div",{staticClass:"flex flex-row"},[i("div",{staticClass:"w-1/2 p-2"},[i("h4",{staticClass:"bg-blue-200 p-1"},[t._v("Staging")]),i("div",[i("i",{staticClass:"material-icons"},[t._v("dns")]),t._v(" "+t._s(t.staging))]),"articles"===t.mode?i("div",[i("div",{staticClass:"font-bold"},[t._v("Articles "),t.total?i("span",[t._v("["+t._s(t.total)+"]")]):t._e()]),i("div",{staticClass:"flex flex-col"},[t._l(t.articles,(function(e,s){return[i("div",{staticClass:"text-sm p-1 flex-row flex mb-1 border shadow cursor-pointer",attrs:{title:"double click to transfer"},on:{dblclick:function(i){t.origin=e,t.confirm=!t.confirm}}},[i("div",{staticClass:"w-8"},[t._v(t._s(s+1))]),i("div",{staticClass:"w-16 mr-4"},[t._v(t._s(t.$moment(e.updated_at)))]),i("div",[t._v(" "+t._s(e.title)+" "),i("br"),t._v(" slug: "),i("i",[t._v(t._s(e.slug))])])])]}))],2)]):t._e(),"components"===t.mode?i("div",[i("div",{staticClass:"font-bold"},[t._v("Components")]),i("div",{staticClass:"grid grid-cols-2 gap-2"},[i("select",{staticClass:"w-full",attrs:{size:"10"}},t._l(t.localcomponents,(function(e){return i("option",{domProps:{value:e},on:{dblclick:function(i){t.origin=e,t.confirm=!t.confirm},click:function(i){t.origin=e}}},[t._v(t._s(e.name))])})),0),t.origin&&t.origin.image_uri?i("div",{staticClass:"bg-gray-800 h-64 w-full bg-contain bg-no-repeat bg-center border",style:"background-image:url("+t.origin.image_uri+")"}):t._e(),t.origin&&t.origin.image&&t.origin.image.url?i("div",{staticClass:"bg-gray-800 h-64 w-full bg-contain bg-no-repeat bg-center border",style:"background-image:url("+t.$imageURL(t.origin.image)+")"}):t._e()])]):t._e(),i("div",{staticClass:"w-full flex justify-around"},[t.start>0?i("i",{staticClass:"material-icons mr-2 text-3xl cursor-pointer",on:{click:t.prev}},[t._v("chevron_left")]):t._e(),t.start<1?i("i",{staticClass:"material-icons mr-2 text-3xl text-gray-300"},[t._v("chevron_left")]):t._e(),t.limit+t.start<t.total?i("i",{staticClass:"material-icons text-3xl cursor-pointer",on:{click:t.next}},[t._v("chevron_right")]):i("i",{staticClass:"material-icons text-3xl cursor-pointer text-gray-300"},[t._v("chevron_right")])])]),i("div",{staticClass:"w-1/2 p-2"},[i("h4",{staticClass:"bg-purple-500 p-1"},[t._v("Production")]),i("draggable",{attrs:{list:t.trash,group:"removed"}},[i("i",{staticClass:"material-icons"},[t._v("dns")]),t._v(" "+t._s(t.master))]),t.articlesRemote||"articles"!==t.mode?t._e():i("div",{staticClass:"bg-lime-300 text-sm p-1"},[t._v("Loading ...")]),t.production&&"articles"===t.mode?i("div",[i("div",{staticClass:"font-bold"},[t._v("Articles")]),t._l(t.articlesRemote,(function(e,s){return[i("div",{staticClass:"text-sm p-1 flex-row flex mb-1 border shadow cursor-pointer",attrs:{title:"double click to transfer"},on:{dblclick:function(i){t.origin=e,t.confirm=!t.confirm}}},[i("div",{staticClass:"w-8"},[t._v(t._s(s+1))]),i("div",{staticClass:"w-16 mr-4"},[t._v(t._s(t.$moment(e.updated_at)))]),i("div",[t._v(" "+t._s(e.title)+" "),i("br"),t._v(" slug: "),i("i",[t._v(t._s(e.slug))])])])]}))],2):t._e(),t.blocks||"components"!==t.mode?t._e():i("div",{staticClass:"bg-lime-300 text-sm p-1"},[t._v("Loading ...")]),t.components&&"components"===t.mode?i("div",[i("div",{staticClass:"font-bold"},[t._v("Components")]),i("div",{staticClass:"grid grid-cols-2"},[i("select",{staticClass:"w-64",attrs:{size:"10"}},t._l(t.blocks,(function(e){return i("option",{domProps:{value:e}},[t._v(t._s(e.name))])})),0)])]):t._e(),t.files&&"upload"===t.mode?i("div",[t._m(0),i("draggable",{staticClass:"flex flex-row flex-wrap bg-gray-300 p-2",staticStyle:{"min-height":"5rem"},attrs:{list:t.serverMedia,group:"media"}},[t._l(t.serverMedia,(function(e,s){return[i("div",{staticClass:"flex items-center text-center justify-center w-24 h-24 mr-2 mb-2",on:{dblclick:function(e){return t.serverMedia.splice(s,1)}},model:{value:t.files,callback:function(e){t.files=e},expression:"files"}},["image"===e.mime.split("/")[0]?i("img",{staticClass:"w-24 h-24 object-cover border",attrs:{src:e.url}}):t._e(),"video"===e.mime.split("/")[0]?i("img",{staticClass:"w-24 h-24 object-cover border",attrs:{src:e.previewUrl}}):t._e(),"image"!=e.mime.split("/")[0]&&"video"!=e.mime.split("/")[0]?i("div",{staticClass:"text-xs border h-24 w-24"},[t._v(t._s(e.name))]):t._e()])]}))],2),t.serverMedia.length?i("button",{on:{click:t.transferMedia}},[t._v("Transfer")]):t._e()],1):t._e()],1)]),t.confirm?i("div",{staticClass:"nuxpresso-modal w-1/3 bg-white z-2xtop p-2 flex flex-col shadow"},[i("h4",[t._v("Confirm transfer")]),t._v(" "+t._s(t.origin.name||t.origin.title)+" "),i("div",{staticClass:"my-2"},[i("button",{staticClass:"float-left mr-2 danger",on:{click:function(e){t.confirm=!t.confirm}}},[t._v("Close")]),i("button",{staticClass:"success",on:{click:function(e){return t.transfer(t.mode,t.origin)}}},[t._v("Yes")])]),t.message?i("div",[t._v(t._s(t.message)+" "),i("button",{staticClass:"warning",on:{click:function(e){t.updateArticle=!0}}},[t._v("YES")])]):t._e()]):t._e()]):i("div")]):t._e()},o=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"font-bold"},[t._v("Media "),i("span",{staticClass:"text-xs"},[t._v("Dblclick to remove image")])])}],a=i("5530"),n=(i("159b"),i("4de4"),i("2f62")),r=i("bc3a"),c=i.n(r),l=i("b76a"),d=i.n(l),u={name:"MokaStaging",components:{draggable:d.a},data:function(){return{articlesRemote:null,total:0,blocks:null,origin:null,mode:"articles",confirm:!1,start:0,limit:10,serverArticles:[],serverMedia:[],trash:[],message:"",updateArticle:!1}},computed:Object(a["a"])(Object(a["a"])({},Object(n["b"])(["moka","user"])),{},{enabled:function(){return"undefined"===typeof webpackHotUpdate&&this.$store.dispatch("message","This option is available only in development mode"),"undefined"!==typeof webpackHotUpdate},dragOptions:function(){return{animation:0,group:"description",disabled:!this.editable,ghostClass:"ghost"}},master:function(){return this.moka.remote_api},staging:function(){return"http://localhost:3030/"},production:function(){var t=this;return console.log("loading"),this.remote.get(this.master+"articles").then((function(e){return t.articlesRemote=e.data,t.$store.dispatch("loading",!1),console.log("loaded articles"),!0}))},components:function(){var t=this;return this.remote.get(this.master+"components").then((function(e){return t.blocks=e.data,!0}))},remote:function(){return c.a}}),watch:{updateArticle:function(t){t&&(this.update(this.mode,this.origin),this.message="",this.updateArticle=!1)}},methods:{next:function(){this.start=this.start+this.limit},prev:function(){this.start=this.start-this.limit},onEndArticle:function(t){this.origin=this.serverArticles[this.serverArticles.length-1],this.confirm=!0},transferMedia:function(){var t=this;this.serverMedia.forEach((function(e){e["Upload"]={status:!0},t.remote.post(t.master+"upload",e,{headers:{Authorization:window.localStorage.getItem("nuxpresso-production-jwt")}}).then((function(t){console.log(t)})).catch((function(t){console.log(t)}))}))},save:function(t,e){var i=this;this.confirm=!1,e.updated_at=this.$moment(new Date,"YYYY-MM-DD HH:mm:ss"),this.remote.post(this.master+t,e,{headers:{Authorization:window.localStorage.getItem("nuxpresso-production-jwt")}}).then((function(t){i.$store.dispatch("message","Data transferred correctly"),console.log(t),"components"===i.mode?i.blocks.push(t.data):i.articlesRemote.push(t.data)})).catch((function(t){console.log(t)}))},update:function(t,e){var i=this;this.remote.put(this.master+t+"/"+e.id,e,{headers:{Authorization:window.localStorage.getItem("nuxpresso-production-jwt")}}).then((function(t){i.$store.dispatch("message","Data transferred correctly"),i.confirm=!1})).catch((function(t){console.log(t)}))},transfer:function(t,e){var i=this;"components"===this.mode?this.$http.get("components/"+e.id).then((function(t){var e=t.data;i.save(i.mode,e)})):this.$http.get("articles/"+e.id).then((function(t){var e=t.data,s=i.articlesRemote.filter((function(t){return t.slug===e.slug}))[0];s?(i.origin=e,i.origin.id=s.id,i.origin.seo_title=e.title,i.origin.seo_description=e.seo_description,i.origin.image&&(i.origin.featured_img=i.origin.image,i.origin.image=null),i.message="An article is present in production with the same slug. Do you want to update the remote article?"):i.save(i.mode,e)}))}},mounted:function(){var t=this;this.$http.get("articles/count").then((function(e){t.total=parseInt(e.data),console.log("total=>",e)})),this.enabled&&this.remote.post(this.master+"auth/local",{identifier:this.moka.remote_user,password:this.moka.remote_password}).then((function(e){console.log(e);e.data.user,e.data.jwt;window.localStorage.setItem("nuxpresso-production-jwt","Bearer "+e.data.jwt),t.remote.headers={Authorization:window.localStorage.getItem("nuxpresso-production-jwt")}})).catch((function(t){console.log(t)}))}},m=u,g=i("2877"),f=Object(g["a"])(m,s,o,!1,null,null,null);e["default"]=f.exports}}]);