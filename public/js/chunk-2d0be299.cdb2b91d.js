(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0be299"],{"2ea1":function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.editor.current?r("div",{staticClass:"bg-gray-100 text-black p-2 text-lg relative"},[r("icon",{staticClass:"absolute right-0 top-0 text-3xl",attrs:{name:"close"},on:{click:function(e){return t.$emit("close")}}}),r("div",{staticClass:"flex flex-row items-center"},[r("icon",{staticClass:"text-5xl",class:t.active?"text-green-500":"text-red-500",attrs:{name:t.active?"toggle_on":"toggle_off"},on:{click:function(e){t.active=!t.active}}}),t._v(" Active ")],1),r("div",{staticClass:"grid grid-cols-2 gap-4 p-2 bg-gray-100 text-gray-700"},[t._l(Object.keys(t.schema),(function(e){return[t.schema[e].edit?r("div",{staticClass:"flex flex-col text-gray-800"},[r("label",{staticClass:"capitalize"},[t._v(t._s(e))]),"string"===t.schema[e].type?r("input",{directives:[{name:"model",rawName:"v-model",value:t.editor.current[e],expression:"editor.current[field]"}],staticClass:"p-2 bg-white rounded border text-base w-full",attrs:{type:"text"},domProps:{value:t.editor.current[e]},on:{input:function(r){r.target.composing||t.$set(t.editor.current,e,r.target.value)}}}):t._e(),"boolean"===t.schema[e].type?r("input",{directives:[{name:"model",rawName:"v-model",value:t.editor.current[e],expression:"editor.current[field]"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.editor.current[e])?t._i(t.editor.current[e],null)>-1:t.editor.current[e]},on:{change:function(r){var i=t.editor.current[e],a=r.target,o=!!a.checked;if(Array.isArray(i)){var s=null,n=t._i(i,s);a.checked?n<0&&t.$set(t.editor.current,e,i.concat([s])):n>-1&&t.$set(t.editor.current,e,i.slice(0,n).concat(i.slice(n+1)))}else t.$set(t.editor.current,e,o)}}}):t._e(),"text"===t.schema[e].type?r("textarea",{directives:[{name:"model",rawName:"v-model",value:t.editor.current[e],expression:"editor.current[field]"}],staticClass:"p-2 bg-white rounded border text-base w-full h-32",domProps:{value:t.editor.current[e]},on:{input:function(r){r.target.composing||t.$set(t.editor.current,e,r.target.value)}}}):t._e(),t._v(" "),"currency"===t.schema[e].type?r("input",{directives:[{name:"model",rawName:"v-model",value:t.editor.current[e],expression:"editor.current[field]"}],staticClass:"p-2 bg-white rounded border text-base",attrs:{type:"text",min:"0"},domProps:{value:t.editor.current[e]},on:{input:function(r){r.target.composing||t.$set(t.editor.current,e,r.target.value)}}}):t._e(),"image_uri"===t.schema[e].type?r("div",[r("div",{staticClass:"flex flex-row"},[t.editor.current.assets?r("img",{staticClass:"w-64 h-56 object-cover",attrs:{src:t.productImage}}):t._e(),r("div",{staticClass:"flex flex-row flex-wrap"},[t._l(t.editor.current.assets,(function(e,i){return t.editor.current.assets.length>1?[i>0?r("img",{staticClass:"w-16 h-16 border object-cover ml-1 mb-1 mr-1",attrs:{src:t.$imageURL(e),title:e}}):t._e()]:t._e()}))],2)]),r("button",{on:{click:function(e){t.assetMode="replace",t.$action("media")}}},[t._v("Replace")]),t._v(" "),r("button",{on:{click:function(e){t.assetMode="add",t.$action("media")}}},[t._v("Add")])]):t._e(),"list"===t.schema[e].type&&"facets"===!e?r("div",{staticClass:"flex flex-row flex-wrap"},[t._l(t.editor.current[e].split(t.schema[e].separator),(function(t){return[r("chip",{attrs:{icon:"close",content:t,css:"text-base bg-indigo-400 rounded text-white mr-2"}})]}))],2):t._e(),"category"===e?r("div",{staticClass:"flex flex-row flex-wrap"},[t.editor.current.category?r("chip",{attrs:{icon:"close",content:t.editor.current.category,css:"text-base bg-indigo-400 rounded text-white mr-2"}}):t._e(),r("select",{directives:[{name:"model",rawName:"v-model",value:t.collection,expression:"collection"}],staticClass:"p-2 bg-white",on:{change:[function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.collection=e.target.multiple?r:r[0]},function(e){return t.getFacets()}]}},t._l(t.categories,(function(e){return r("option",{domProps:{value:e}},[t._v(t._s(e.name))])})),0)],1):t._e(),"facets"===e?r("div",{staticClass:"flex flex-col"},[r("div",{staticClass:"flex flex-row flex-wrap"},[r("select",{directives:[{name:"model",rawName:"v-model",value:t.productFacet,expression:"productFacet"}],staticClass:"p-2 bg-white border rounded",on:{change:[function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.productFacet=e.target.multiple?r:r[0]},function(e){return t.addFacet()}]}},t._l(t.collectionFacets,(function(e){return r("option",{domProps:{value:e}},[t._v(t._s(e.name))])})),0)]),r("div",{staticClass:"flex flex-row flex-wrap mt-4"},[t._l(t.editor.current.facets,(function(e,i){return Array.isArray(t.editor.current.facets)?[e?r("chip",{attrs:{css:"text-base bg-teal-400 rounded text-white mr-2",content:e,icon:"close"},on:{click:function(e){return t.editor.current.facets.splice(i,1)}}}):t._e()]:t._e()}))],2)]):t._e()]):t._e()]}))],2),r("div",{staticClass:"flex flex-col w-full p-2 relative mb-8"},[r("icon",{staticClass:"text-black text-3xl absolute top-0 right-0 m-2",attrs:{name:"add"},on:{click:function(e){return t.addOption()}}}),r("div",{staticClass:"grid grid-cols-3 gap-3 border p-2 items-center justify-center"},[r("div",[t._v("Option"),t.variations&&t.variations.length?r("span",[t._v("/Variation")]):t._e()]),r("div",[t._v("SKU")]),r("div",[t._v("Price")]),r("div",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.editor.current.optionValues||t.editor.current.name,expression:"editor.current.optionValues||editor.current.name"}],staticClass:"p-2 bg-white rounded border text-base",attrs:{type:"text"},domProps:{value:t.editor.current.optionValues||t.editor.current.name},on:{input:function(e){e.target.composing||t.$set(t.editor.current.optionValues||t.editor.current,"name",e.target.value)}}})]),r("div",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.editor.current.sku,expression:"editor.current.sku"}],staticClass:"p-2 bg-white rounded border text-base",attrs:{type:"text"},domProps:{value:t.editor.current.sku},on:{input:function(e){e.target.composing||t.$set(t.editor.current,"sku",e.target.value)}}})]),r("div",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.editor.current.price,expression:"editor.current.price"}],staticClass:"p-2 bg-white rounded border text-base",attrs:{type:"text"},domProps:{value:t.editor.current.price},on:{input:function(e){e.target.composing||t.$set(t.editor.current,"price",e.target.value)}}})]),t._l(t.variations,(function(e,i){return t.variations?[r("div",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.variations[i].optionValues,expression:"variations[i].optionValues"}],staticClass:"p-2 bg-white rounded border text-base",attrs:{type:"text"},domProps:{value:t.variations[i].optionValues},on:{input:function(e){e.target.composing||t.$set(t.variations[i],"optionValues",e.target.value)}}})]),r("div",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.variations[i].sku,expression:"variations[i].sku"}],staticClass:"p-2 bg-white rounded border text-base",attrs:{type:"text"},domProps:{value:t.variations[i].sku},on:{input:function(e){e.target.composing||t.$set(t.variations[i],"sku",e.target.value)}}})]),r("div",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.variations[i].price,expression:"variations[i].price"}],staticClass:"p-2 bg-white rounded border text-base",attrs:{type:"text"},domProps:{value:t.variations[i].price},on:{input:function(e){e.target.composing||t.$set(t.variations[i],"price",e.target.value)}}}),r("icon",{staticClass:"ml-4 text-3xl",attrs:{name:"close"},on:{click:function(r){return t.removeOption(e._id,i)}}})],1)]:t._e()}))],2)],1),r("div",{staticClass:"w-full text-center"},[r("button",{staticClass:"danger rounded lg m-auto mx-1",on:{click:function(e){return t.$emit("close")}}},[t._v("Close")]),r("button",{staticClass:"success rounded lg m-auto mx-1",on:{click:function(e){return t.saveProduct()}}},[t._v("Save")])])],1):t._e()},a=[],o=r("5530"),s=(r("b0c0"),r("159b"),r("7db0"),r("caad"),r("2532"),r("a434"),r("4de4"),r("ac1f"),r("1276"),r("2f62")),n=r("a0aa"),c={name:"WhoobeProductEdit",data:function(){return{active:!0,current:null,assetMode:"replace",images:!1,variations:null,categories:null,collection:null,collectionFacets:null,productFacet:null,facets:null}},props:["id"],computed:Object(o["a"])(Object(o["a"])({},Object(s["b"])(["editor"])),{},{schema:function(){return n["default"]},productImage:function(){if("replace"===this.assetMode&&this.editor.current.image)Array.isArray(this.editor.current.assets)?this.editor.current.assets[0]=this.editor.current.image.url:this.editor.current.assets=[this.editor.current.image.url];else if(Array.isArray(this.editor.current.assets))this.editor.current.image&&this.editor.current.assets.push(this.editor.current.image.url),this.editor.current.image=null;else{var t=[this.editor.current.assets];this.editor.current.image&&t.push(this.editor.current.image.url),console.log(t),this.editor.current.assets=t}return this.$imageURL(this.editor.current.assets[0])}}),watch:{active:function(t){this.editor.current.active=t}},methods:{saveProduct:function(){var t=this;this.editor.current.optionValues&&(this.editor.current.optionValues=this.editor.current.optionValues.replaceAll("|"," ")),this.editor.current.category=this.collection.name,this.editor.current.category_id=this.collection._id,this.$api.service("products").patch(this.editor.current._id,this.editor.current).then((function(e){t.$message("Product saved"),console.log(e),t.variations&&t.variations.length&&t.variations.forEach((function(e){t.$api.service("products").patch(e._id,e).then((function(t){console.log("save variation",t)}))}))}))},getFacets:function(){var t=this;this.editor.current.category=this.collection.name,this.$api.service("categories").find({query:{collection:this.collection._id}}).then((function(e){t.collectionFacets=e.data}))},addFacet:function(t){console.log(t),this.productFacet=t,console.log(this.productFacet),Array.isArray(this.editor.current.facets)?!this.editor.current.facets.includes(this.productFacet.name)&&this.editor.current.facets.push(this.productFacet.name):this.editor.current.facets=[this.productFacet.name]},removeFacet:function(t){this.editor.current.facets.splice(t,1)},addOption:function(){var t=this,e=Object.assign({},this.editor.current);e.parent=e.sku,e.sku="",e.type="variation",delete e._id,delete e.createdAt,delete e.updatedAt,this.$api.service("products").create(e).then((function(e){t.variations.push(e)}))},removeOption:function(t,e){var r=this;this.$api.service("products").remove(t).then((function(t){r.variations.splice(e,1)}))}},mounted:function(){var t=this;this.$api.service("products").find({query:{$limit:50,parent:this.editor.current.sku,$sort:{optionValues:1}}}).then((function(e){t.variations=e.data})),this.$api.service("categories").find({query:{$limit:50,type:"product",$sort:{name:1}}}).then((function(e){t.categories=e.data,t.collection=t.editor.current.category?e.data.filter((function(e){return e.name===t.editor.current.category}))[0]:null,t.collection&&t.getFacets()})),!this.editor.current.hasOwnProperty("active")&&(this.editor.current.active=!0),this.facets=this.editor.current.facets?Array.isArray(this.editor.current.facets)?null:this.editor.current.facets.split("|"):null}},u=c,l=r("2877"),d=Object(l["a"])(u,i,a,!1,null,null,null);e["default"]=d.exports}}]);